<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Search Results</title>
		
		<!-- Universal stylesheet for all pages -->
		<link rel="stylesheet" href="../assets/css/universal_styles.css">
		
		<!-- Stylesheet for this specific page -->
		<link rel="stylesheet" href="../assets/css/legacy_modding_minecraft_wiki_styles.css">
		
		<!-- Page title -->
		<title>Search results</title>
		
		<!-- No favicon for now. -->
		<link rel="icon" type="image/x-icon" href="assets/images/">
		
		<!-- Universal javascript for all pages -->
		<script src="../assets/javascript/universal.js" defer></script>
	</head>
	<body>
		<nav class="top-navigation-bar">
			<a href="/">Back to the wiki home page</a>
			<!-- If this anchor tag gets deleted the navbar disappears, so it will remain here for now. -->
		</nav>
		
		<br>
		<br>
		<br>
		
		<div class="information-section">
			<h1>Search Results</h1>
			
			<hr>
			
			<div id="status"></div>
			<div id="results"></div>

			<script>
				const PAGES_TO_INDEX = [
					{ title: "Home", url: "/" },
					{ title: "1.12.2 Forge wiki", url: "/1.12.2_forge/" },
					{ title: "Contribution Guidelines and TO-DO list", url: "/contribution_guidelines/" },
					{ title: "1.7.10 Special cases wiki", url: "/1.7.10_special/" }
					// More pages go here
				];

				let INDEX = [];

				async function buildIndex() {
					const statusEl = document.getElementById("status");
					statusEl.textContent = "Building search index...";

					const promises = PAGES_TO_INDEX.map(async page => {
						try {
							const res = await fetch(page.url);
							const html = await res.text();

							const tmp = document.createElement("div");
							tmp.innerHTML = html;
							const text = tmp.textContent.toLowerCase();

							INDEX.push({
								title: page.title,
								url: page.url,
								content: text
							});
						} catch (e) {
							console.error("Failed to index", page.url, e);
						}
					});

					await Promise.all(promises);
					statusEl.textContent = "";
				}

				function performSearch(query) {
					const resultsContainer = document.getElementById("results");
					const q = query.toLowerCase().trim();

					if (!q) {
						resultsContainer.innerHTML = "<p>No search query provided.</p>";
						return;
					}

					const matches = INDEX.filter(page => page.content.includes(q));

					if (matches.length === 0) {
						resultsContainer.innerHTML = `<p>No results found for "<b>${query}</b>".</p>`;
						return;
					}

					resultsContainer.innerHTML = `
						<h2>Search results for "<b>${query}</b>"</h2>
						<br>
						${matches.map(page => {
							const snippet = extractSnippet(page.content, q);
							return `
								<div class="search-result">
									<h3><a href="${page.url}">${page.title}</a></h3>
									<p>${snippet}</p>
								</div>
							`;
						}).join("")}
					`;
				}
				
				function extractSnippet(text, query) {
					const index = text.indexOf(query);
					if (index === -1) return "";

					const start = Math.max(0, index - 75);
					const end = Math.min(text.length, index + query.length + 75);

					let snippet = text.substring(start, end);

					// Highlight the match
					const regex = new RegExp(query, "gi");
					snippet = snippet.replace(regex, match => `<mark>${match}</mark>`);

					return snippet + "...";
				}

				async function init() {
					const params = new URLSearchParams(window.location.search);
					const query = params.get("q") || "";

					await buildIndex();
					performSearch(query);
				}
				
				init();
			</script>
		</div>
		
		<br>
		
		<footer>
			<p>&copy; 2026-2026 wikiformoddinglegacyminecraftjava All rights reserved.</p>
			<p>Website first created on February 4, 2026</p>
			<p>Website first published on February 4, 2026</p>
			<p>Website last updated on <span id="site-last-updated"></span></p>
		</footer>
	</body>
</html>
